<head>
	<link rel="stylesheet" type="text/css" href="src/linked-charts.css">
	<link rel="stylesheet" type="text/css" href="src/style.css">
	<script type="text/javascript" src = "src/linked-charts.min.js"></script>
	<script type="text/javascript" src = "src/data.js"></script>
	<title>Ex2plorer</title>
</head>
<body>
	<div style="border-bottom: 1px solid #CCC;">
		<div id = "topbar">
			<img src = "src/Mammalian_evolutionTransparent.png" width = "150px" style = "margin-left: 10px;">
			<div><span style="font-style: italic; color: #B2303A">Ex<sup>2</sup></span>plorer</div>
		</div>
	</div>
	<div id = "plots" style="display: grid;">
		<div id = "tissues" style="text-align: center; grid-column: 1; grid-row: 1;"></div>
		<div id = "mainPlot" style="grid-column: 1; grid-row: 2/4;"></div>
		<div id = "geneName" style=""></div>
		<div id = "transcription" style="grid-column: 2; grid-row: 2;"></div>
		<div id = "translation" style="grid-column: 3; grid-row: 2;"></div>
		<div id = "geneInfo"></div>
	</div>
	<script type="text/javascript">
		var tissues = ["Brain", "Liver", "Testis"],
			colours = {Brain: "#3399CC", Liver: "#339900", Testis: "#FF6600"},
			tissue = "Brain",
			species = ["Human", "Macaque", "Mouse", "Opossum", "Platypus", "Chicken"];

		d3.select("#tissues")
			.selectAll(".icon")
				.data(tissues)
				.enter()
					.append("img")
					.attr("width", 75)
					.attr("src", d => "src/" + d + ".svg")
					.attr("title", d => d)
					.attr("class", d => d == tissue ? "icon active" : "icon")
					.on("click", function(d) {
						tissue = d;
						d3.select("#tissues")
							.selectAll(".icon")
								.classed("active", false);
						d3.select(this).classed("active", true);
						mainPlot.update();
						tr.update();
						tl.update();
					});

		data = lc.separateBy(data, ["tissue", "geneId"]);
		var gene = 0;

		var mainPlot = lc.scatter()
			.elementIds(Object.keys(data[tissue]))
			.x(d => data[tissue][d].med)
			.y(d => data[tissue][d].delta)
			.domainY([-3, 3])
			.domainX([0, 10])
			.colour(d => data[tissue][d].padj < 0.1 ? (data[tissue][d].delta < 0 ? "#A6AE00" : "#9F00FF") : "white")
			.opacity(d => data[tissue][d].padj < 0.1 ? 0.8 : 0.4)
			.stroke(function() {return colours[tissue]})
			.strokeWidth(d => data[tissue][d].padj < 0.1 ? 1 : 2)
			.size(d => data[tissue][d].padj < 0.1 ? 2 : 1)
			.on_click(function(d) {
				gene = fpkm.indexOf(d);
				tr.update();
				tl.update();
			})
			.place("#mainPlot");

		var tr = lc.xLine("grid")
			.width(300)
			.height(300)
			.set_paddings({left: 65})
			.domainY(species)
			.title("Transcriptional layer")
			.ticksRotateX(45)
			.elementIds(species)
			.lineFun((x, d) => d)
			.dasharray(1.5)
			.lineWidth(0.5)
			.colour(function() {return colours[tissue]});

		lc.pointLine("range", tr)
			.elementIds(species)
			.nsteps(2)
			.lineWidth(2.5)
			.y((i, d) => d)
			.x((i, d) => fpkm[d + "_" + tissue + "_TR_" + (i == 0 ? "min" : "max")][gene])
			.colour(function() {return colours[tissue]});

		lc.scatter("points", tr)
			.elementIds(species)
			.x(d => fpkm[d + "_" + tissue + "_TR_med"][gene])
			.y(d => d)
			.colour("white")
			.stroke(function() {return colours[tissue]})
			.place("#transcription");

		var tl = lc.xLine("grid")
			.width(300)
			.height(300)
			.set_paddings({left: 65})
			.domainY(species)
			.title("Translational layer")
			.ticksRotateX(45)
			.elementIds(species)
			.lineFun((x, d) => d)
			.dasharray(1.5)
			.lineWidth(0.5)
			.colour(function() {return colours[tissue]});

		lc.pointLine("range", tl)
			.elementIds(species)
			.nsteps(2)
			.lineWidth(2.5)
			.y((i, d) => d)
			.x((i, d) => fpkm[d + "_" + tissue + "_RP_" + (i == 0 ? "min" : "max")][gene])
			.colour(function() {return colours[tissue]});

		lc.scatter("points", tl)
			.elementIds(species)
			.x(d => fpkm[d + "_" + tissue + "_RP_med"][gene])
			.y(d => d)
			.colour(function() {return colours[tissue]})
			.stroke(function() {return colours[tissue]})
			.place("#translation");


	</script>
</body>